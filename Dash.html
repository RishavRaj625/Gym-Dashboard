<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            color: #667eea;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .auth-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .upload-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .upload-section.active {
            display: block;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 50px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: rgba(102, 126, 234, 0.05);
        }

        .upload-area.dragover {
            border-color: #764ba2;
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 10px;
        }

        .upload-subtext {
            color: #999;
            font-size: 0.9rem;
        }

        .file-input {
            display: none;
        }

        .media-grid {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .media-grid.active {
            display: block;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .media-item {
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .media-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }

        .media-preview {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .media-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .media-name {
            font-size: 0.9rem;
            color: #333;
            font-weight: 500;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .delete-btn {
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .delete-btn:hover {
            background: #ff3838;
            transform: scale(1.1);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #eee;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 15px;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        .status-message {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .search-bar {
            width: 100%;
            padding: 15px;
            border: 2px solid #667eea;
            border-radius: 50px;
            font-size: 1rem;
            margin-bottom: 20px;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-bar:focus {
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .grid-container {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
            }

            .upload-area {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-cloud-upload-alt"></i> Media Dashboard</h1>
            <p>Upload and manage your images and videos with Google Drive integration</p>
        </div>

        <div class="auth-section" id="authSection">
            <h2>Connect to Google Drive</h2>
            <p>Sign in to your Google account to start uploading and managing your media files.</p>
            <button class="btn" id="signInBtn">
                <i class="fab fa-google"></i> Sign in with Google
            </button>
        </div>

        <div class="upload-section" id="uploadSection">
            <h2>Upload Media Files</h2>
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <div class="upload-text">Drag & drop files here or click to browse</div>
                <div class="upload-subtext">Supports images (JPG, PNG, GIF) and videos (MP4, MOV, AVI)</div>
            </div>
            <input type="file" id="fileInput" class="file-input" multiple accept="image/*,video/*">
            
            <div class="progress-bar" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div class="status-message" id="statusMessage"></div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" id="signOutBtn">
                    <i class="fas fa-sign-out-alt"></i> Sign Out
                </button>
            </div>
        </div>

        <div class="media-grid" id="mediaGrid">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Your Media Files</h2>
                <button class="btn" id="refreshBtn">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
            
            <input type="text" class="search-bar" id="searchBar" placeholder="Search your files...">
            
            <div class="grid-container" id="gridContainer">
                <!-- Media items will be loaded here -->
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/google-auth-library/8.7.0/google-auth-library.min.js"></script>
    <script>
        // Google Drive API Configuration
        const CLIENT_ID = 'YOUR_GOOGLE_CLIENT_ID';
        const API_KEY = 'YOUR_GOOGLE_API_KEY';
        const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        let tokenClient;
        let gapiInited = false;
        let gisInited = false;
        let mediaFiles = [];

        // DOM Elements
        const authSection = document.getElementById('authSection');
        const uploadSection = document.getElementById('uploadSection');
        const mediaGrid = document.getElementById('mediaGrid');
        const signInBtn = document.getElementById('signInBtn');
        const signOutBtn = document.getElementById('signOutBtn');
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const statusMessage = document.getElementById('statusMessage');
        const gridContainer = document.getElementById('gridContainer');
        const searchBar = document.getElementById('searchBar');
        const refreshBtn = document.getElementById('refreshBtn');

        // Initialize Google APIs
        function gapiLoaded() {
            gapi.load('client', initializeGapiClient);
        }

        async function initializeGapiClient() {
            await gapi.client.init({
                apiKey: API_KEY,
                discoveryDocs: [DISCOVERY_DOC],
            });
            gapiInited = true;
            maybeEnableButtons();
        }

        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: '', // defined later
            });
            gisInited = true;
            maybeEnableButtons();
        }

        function maybeEnableButtons() {
            if (gapiInited && gisInited) {
                signInBtn.style.display = 'inline-flex';
            }
        }

        // Authentication
        function handleAuthClick() {
            tokenClient.callback = async (resp) => {
                if (resp.error !== undefined) {
                    throw (resp);
                }
                await showUploadSection();
            };

            if (gapi.client.getToken() === null) {
                tokenClient.requestAccessToken({prompt: 'consent'});
            } else {
                tokenClient.requestAccessToken({prompt: ''});
            }
        }

        function handleSignoutClick() {
            const token = gapi.client.getToken();
            if (token !== null) {
                google.accounts.oauth2.revoke(token.access_token);
                gapi.client.setToken('');
                showAuthSection();
            }
        }

        function showAuthSection() {
            authSection.style.display = 'block';
            uploadSection.classList.remove('active');
            mediaGrid.classList.remove('active');
        }

        async function showUploadSection() {
            authSection.style.display = 'none';
            uploadSection.classList.add('active');
            mediaGrid.classList.add('active');
            await loadMediaFiles();
        }

        // File Upload
        function handleFileSelect(files) {
            if (files.length === 0) return;

            progressBar.style.display = 'block';
            statusMessage.style.display = 'none';

            uploadFiles(files);
        }

        async function uploadFiles(files) {
            const totalFiles = files.length;
            let uploadedFiles = 0;

            for (const file of files) {
                try {
                    await uploadFileToGoogleDrive(file);
                    uploadedFiles++;
                    updateProgress((uploadedFiles / totalFiles) * 100);
                } catch (error) {
                    console.error('Upload failed:', error);
                    showStatusMessage('Upload failed for some files', 'error');
                }
            }

            if (uploadedFiles === totalFiles) {
                showStatusMessage('All files uploaded successfully!', 'success');
                await loadMediaFiles();
            }

            progressBar.style.display = 'none';
        }

        async function uploadFileToGoogleDrive(file) {
            const metadata = {
                name: file.name,
                parents: ['YOUR_FOLDER_ID'] // Optional: specify a folder ID
            };

            const form = new FormData();
            form.append('metadata', new Blob([JSON.stringify(metadata)], {type: 'application/json'}));
            form.append('file', file);

            const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                method: 'POST',
                headers: new Headers({
                    'Authorization': `Bearer ${gapi.client.getToken().access_token}`
                }),
                body: form
            });

            return await response.json();
        }

        function updateProgress(percent) {
            progressFill.style.width = percent + '%';
        }

        function showStatusMessage(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${type}`;
            statusMessage.style.display = 'block';
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 5000);
        }

        // Media Management
        async function loadMediaFiles() {
            try {
                const response = await gapi.client.drive.files.list({
                    q: "mimeType contains 'image/' or mimeType contains 'video/'",
                    fields: 'files(id,name,mimeType,thumbnailLink,webViewLink)',
                    orderBy: 'createdTime desc'
                });

                mediaFiles = response.result.files;
                renderMediaGrid();
            } catch (error) {
                console.error('Error loading files:', error);
                showStatusMessage('Error loading files', 'error');
            }
        }

        function renderMediaGrid(filteredFiles = null) {
            const files = filteredFiles || mediaFiles;
            gridContainer.innerHTML = '';

            if (files.length === 0) {
                gridContainer.innerHTML = '<p style="text-align: center; color: #666; grid-column: 1 / -1;">No files found</p>';
                return;
            }

            files.forEach(file => {
                const mediaItem = createMediaItem(file);
                gridContainer.appendChild(mediaItem);
            });
        }

        function createMediaItem(file) {
            const item = document.createElement('div');
            item.className = 'media-item';

            const isVideo = file.mimeType.startsWith('video/');
            const preview = isVideo ? 
                `<video class="media-preview" controls><source src="${file.webViewLink}" type="${file.mimeType}"></video>` :
                `<img class="media-preview" src="${file.thumbnailLink || file.webViewLink}" alt="${file.name}">`;

            item.innerHTML = `
                ${preview}
                <div class="media-info">
                    <span class="media-name" title="${file.name}">${file.name}</span>
                    <button class="delete-btn" onclick="deleteFile('${file.id}', '${file.name}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;

            return item;
        }

        async function deleteFile(fileId, fileName) {
            if (!confirm(`Are you sure you want to delete "${fileName}"?`)) {
                return;
            }

            try {
                await gapi.client.drive.files.delete({
                    fileId: fileId
                });
                
                showStatusMessage('File deleted successfully', 'success');
                await loadMediaFiles();
            } catch (error) {
                console.error('Error deleting file:', error);
                showStatusMessage('Error deleting file', 'error');
            }
        }

        // Search functionality
        function filterFiles(searchTerm) {
            const filtered = mediaFiles.filter(file => 
                file.name.toLowerCase().includes(searchTerm.toLowerCase())
            );
            renderMediaGrid(filtered);
        }

        // Event Listeners
        signInBtn.addEventListener('click', handleAuthClick);
        signOutBtn.addEventListener('click', handleSignoutClick);
        refreshBtn.addEventListener('click', loadMediaFiles);

        uploadArea.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => handleFileSelect(e.target.files));

        searchBar.addEventListener('input', (e) => filterFiles(e.target.value));

        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            handleFileSelect(e.dataTransfer.files);
        });

        // Load Google APIs
        window.gapiLoaded = gapiLoaded;
        window.gisLoaded = gisLoaded;
    </script>
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>